stages:
  - generate  # âœ… å®šç¾©éšŽæ®µ

generate_cre_files:
  stage: generate
  image: alpine:latest  # âœ… ä½¿ç”¨ Alpine è¼•é‡æ˜ åƒ
  before_script:
    - apk add --no-cache jq  # âœ… å®‰è£ jqï¼Œç”¨ä¾†è§£æž JSON
  script:
    - echo "ðŸ“‚ å»ºç«‹ cre_files è³‡æ–™å¤¾"
    - mkdir -p cre_files

    - echo "ðŸ” å¾ž passwords.json è§£æžç”¢ç”Ÿ .cre æª”æ¡ˆ"
    - |
      for key in $(jq -r 'keys[]' passwords.json); do  # âœ… é€ä¸€è®€å– JSON çš„æ¯å€‹ keyï¼Œä¾‹å¦‚ aa, bb, cc
        var_name=$(jq -r --arg k "$key" '.[$k]' passwords.json)  # âœ… å–å¾—è©² key å°æ‡‰çš„è®Šæ•¸åï¼Œä¾‹å¦‚ ap, bp, cp
        var_value=$(printenv "$var_name")  # âœ… å¾ž GitLab CI/CD ç’°å¢ƒè®Šæ•¸ä¸­è®€å‡ºå€¼ï¼Œä¾‹å¦‚ 111
        echo -n "$var_value" > "cre_files/${key}.cre"  # âœ… å¯«å…¥ cre_files/aa.cre
        echo "âœ… å·²å»ºç«‹ cre_files/${key}.cre"
      done

  artifacts:
    paths:
      - cre_files/  # âœ… ç”¢ç”Ÿçš„ cre_files è³‡æ–™å¤¾æœƒè¢«æ‰“åŒ…ä¸Šå‚³ artifacts
